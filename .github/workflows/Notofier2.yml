name: GitHub to Discord Relay

on:
  push:
  pull_request:
  issues:
  release:
    types: [published]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send event to relay webhook
        env:
          WEBHOOK_URL: https://soft-cloud-7e79.gamerzayush62.workers.dev/
        run: |
          # Build JSON payload with more event info
          EVENT_DATA=$(jq -n \
            --arg name "$GITHUB_EVENT_NAME" \
            --arg repo "$GITHUB_REPOSITORY" \
            --arg actor "$GITHUB_ACTOR" \
            --arg ref "$GITHUB_REF" \
            --arg sha "$GITHUB_SHA" \
            --arg url "$GITHUB_SERVER_URL/$GITHUB_REPOSITORY" \
            '{
              event: $name,
              repository: $repo,
              actor: $actor,
              ref: $ref,
              sha: $sha,
              url: $url
            }'
          )
          echo "Sending payload: $EVENT_DATA"
          curl -X POST -H "Content-Type: application/json" \
               -d "$EVENT_DATA" \
               "$WEBHOOK_URL"
